# Volumes

Volumes are the organizational unit in Blobcache.
All client data is stored in a Volume.
Volumes are uniquely identified on a given Node by an arbitrary 128 bit identifier.
This ID cannot be changed---since that would be, definitionally, a different volume.
The ID will also never be reused for another Volume after the first one is dropped.

Volumes are uniquely identified on the network by the pair (Node ID, Volume ID).
You can think of this pair as (where, what), since the NodeID determines which machine the Volume is.

## Cell & Store
Volumes can be thought of as having 2 distinct parts, a set of immutable content-addressed Blobs (called the "store"), and a single mutable cell (called the "cell").
These 2 parts can be modified consistently by performing transactions on the Volume.

### Blobs
Blobs are the unit of data in Blobcache.
They are sequences of bytes ranging from 0 to a few megabytes in length.

Posting Blobs to a Volume's store gives back a Content Identifier (CID).
CIDs are used to retrieve the Blob from the store later, while providing cryptographic proof that the data is unchanged.

Adding or removing Blobs only add or removes them for that Volume.
Blobs are not stored more than once per Node, so a Blob that is in multiple Volumes takes up very little additional space.

### Persistent Data Structures

Volumes are designed to hold [persistent data structures](https://en.wikipedia.org/wiki/Persistent_data_structure).
When a persistent data structure is modified, no part of it is deleted or changed.
Instead, a new datastructure, often sharing most of its structure with the previous, is created.
The reference to the old datastructure is replaced with a reference to the new one.

## Links
When a Volume is first created the client receives a Handle to it.
If the Handle is not used regularly, then it will expire.
When any object in Blobcache loses all of the handles pointing to it, it is cleaned up automatically.
This means that temporary/anonymous volumes can be created as scratch space, without requiring any additional permissions to persist data, and they will be cleaned up automatically when forgotten.

To persist data indefinitely, Blobcache always persists one of the volumes indefinitely, and allows Volumes to be linked to it.
A Volume will not be deleted as long as there are links pointing to it.
The links from a Volume to other Volumes are stored in that Volume according to its Schema.
Reading links and getting links to other Volumes is done through the same mechanism that data is read from the Volume.

## API

Volumes have a simple API that provides only 2 actions.
- Beginning a transaction
- Awaiting a change

Opening a transaction presents the user with a way to read and write the data structure stored in the Volume.
Awaiting for the volume to change provides a way for client applications to be notified and react to successfully completed transactions, which they did not author themselves.

## Parameters
Volumes have a few parameters that can be set.
More may be added over time, but these are the most important ones.
- Hash algorithm
- Max blob size, the max cell size is set to half the max blob size.
- Schema, the name of the Schema to use to validate and read the Volume's contents.

## Backends

Although all Volumes support the same API, there are many different types of Volumes implemented in different ways.

The default Volume stores data on the local Blobcache Node.
There are also backends for:
- accessing Volumes on remote nodes
- encryption with a symmtric cipher
- using a Git repository as a Volume.
